---
title: "课程笔记-微服务基础"
date: 2021-08-07 11:00:00 +0800
categories: pluralsights, 
---

## 这门课讲了什么

### 整体

一门微服务的简介课程，号称结合eShopContainer，但是很明显并未结合太多代码实例分析，只是从eShop的解决方案架构上介绍了一下。课程大多是理论、概念的介绍，以及经历过实践活动后的经验之谈，没有特别具体的某个技术的应用和选型，比如微服务网关consul, etcd, zookeeper的不同优劣势。

不过也对，定位为基础课程，就不需要在某一个局部进行深入，而是需要面面俱到的提到。

### 局部细节

我列出课程的一级目录，然后把每节我留下印记的地方多写一下。

- Introducing Microservices

  - 单体应用在应用开始的时候并没有什么问题，只是随着系统业务规则越来越复杂，面临的挑战越来越大。有的时候就开始了“微服务改造”，但这些改造最不合适的就是新写了业务代码，业务API，但是还是和原有系统共享数据库。这样非常不好，单体和微服务的好处都没有得到，反而是得到了双方的缺点。部署麻烦，数据库记录难以追溯，因为并不知道是哪部分业务逻辑，需要改这些记录。

- Architecting Microservices

  - 同上，新业务系统启动的时候，不建议一上来就建立成微服务。这样会无端增加复杂度。

  - 微服务需要有自己独立的库表存储。并且不用怕，有时候是需要服务自己缓存一些别的服务领域的数据。这有点像数据库里面的三范式规则，在微服务中，不用担心打破这个规则。因为如果自己不存储，那每一次需要用到数据，都去调用别的服务，代价比数据库中的join要大得多。

  - 微服务的每一个服务都需要独立部署，独立认证，授权。每一个服务都是自成体系的一个小应用。

  - 应用颗粒拆到多细这个需要持续调整。有的服务可能就是几行代码，但更多的服务会远远比几行代码复杂。

  - 主要是取决于业务领域边界。需要看看看起来同一个概念，但是在不同的业务领域，关注点不同，关注细节不同，那这样可能就不适合放到一个服务中。比如在会员、会籍领域中，和订单领域中，对于“客户”这个概念的关注点有很大不同。会员领域关注会员等级，续费时间等，订单领域中，关注的更多是客户的地址，联系方式等基本信息。因此在这两个领域中，都会有客户的概念，但细节不同。

- Building Microservices

  - 首先要容器化，然后再通过k8s或者类似技术，将这些docker镜像按照指定顺序能够呼唤起来，随时能够在各种环境下，包括本地开发环境，把需要的应用，基础设施，都唤起。

  - 各个微服务应用都需要有完善的自动化测试，包括UT，集成，API，甚至E2E。

- Communicating Between Microservices

  - 微服务间的通信分为同步和异步两类。包括API直接调用，webhooks回调，以及通过消息队列的异步调用。

  - 消息间的调用支持柔性调用，即有重试和熔断机制，这样能够保证最终一致性以及系统的整体可用。

  - 服务之间通过服务发现，能够自动注册，自动发现所需要的服务提供方，并且支持负载均衡，主从切换等。

- Securing Microservices

  - 安全是一个全方位的话题，不能仅仅在一个层面上做安全。必须从网络，传输，认证，鉴权都要考虑到。一个环节的失位，会导致整个安全工作都有很大隐患。

  - 传输层通常指的是TLS。网络指的是NAT划分，甚至IP白名单使用等看起来非常传统的方式。

  - 认证包括应用之间的认证，也包括用户的认证。并且这两者需要结合一起使用。比如一个订单服务收到用户下订单并支付的请求后，需要调用支付服务。支付服务对订单服务有一个系统认证和鉴权，但并不能仅仅依赖于此，订单服务仍然需要告诉支付服务，它是在为哪个用户做这件事情，这样支付服务再去鉴权，看看该用户是否有正确的权限完成这个事情。比如，A用户不能使用B用户的信用卡支付。

- Delivering Microservices

  - 自动化。一切都自动化。有多种部署方式，蓝绿，灰度等。

  - 交付物管理。交付物能够被维护起来，这样有新环境需要部署时，能够知道从哪里能够获取到稳定可靠的交付物。

  - 微服务需要有一系列监控。包括环境层面的CPU，内存，网络吞吐，到应用系统自身健康检查，环境配置检查等。更为重要的是，这些信息需要输出到集中的地方，比如ELK，或者其它类似产品。

## 有道理吗

有道理，都是比较浅显简单的大道理。不过这些道理也有很多是实践后才能总结出来。

## 我能带走什么

就像刚才在局部细节里面讲到的哪些点，能够带走，并在日常开发过程中践行下去，就很厉害了。一步步实施，一步步做。

最后，课程链接放到[这里](https://app.pluralsight.com/library/courses/microservices-fundamentals/table-of-contents)，推荐倍速播放。
